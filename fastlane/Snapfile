# Snapfile for Fastlane Snapshot automation
# Captures automated screenshots for App Store submission

# Path to Xcode project
project "./ListAll/ListAll.xcodeproj"

# List of simulators to use for screenshot generation
# Using iOS 17.5 (available on macos-14 with Xcode 16.1)
# iPhone 15 Pro Max is 6.7" which is acceptable for App Store 6.5" slot
devices([
  "iPhone 15 Pro Max (17.5)",      # 6.7" display (closest to App Store 6.5" requirement)
  "iPad Pro 13-inch (M4) (17.5)"   # 13" iPad Pro for App Store screenshots
])

# List of languages to generate screenshots for
# Screenshots will be generated for both English and Finnish
languages([
  "en-US",
  "fi"
])

# The name of the scheme which contains the UI Tests
scheme("ListAll")

# Where should the resulting screenshots be stored?
output_directory("./fastlane/screenshots")

# Clear previous screenshots before generating new ones
clear_previous_screenshots(true)

# Erase simulators before running (built-in fastlane option)
# More reliable than manual xcrun simctl erase in CI
erase_simulator(true)

# Remove the '#' from the image filename
override_status_bar(true)

# Reinstall the app before each test run
reinstall_app(true)

# Let snapshot build the app (more reliable in CI)
# Setting this to false means snapshot will build the app itself
test_without_building(false)

# Disable code signing for simulator builds (not needed, prevents hangs)
xcargs("CODE_SIGN_IDENTITY='' CODE_SIGNING_REQUIRED=NO CODE_SIGNING_ALLOWED=NO")

# Run devices sequentially to avoid signing deadlocks in CI
# Concurrent mode causes keychain access conflicts during code signing
concurrent_simulators(false)

# Increase retry count for CI stability (handles occasional segfaults)
# Snapshot automatically retries on random failures
number_of_retries(2)

# Only run the UI test target for screenshot capture (skip unit tests)
# This dramatically speeds up execution since unit tests already run in CI
only_testing(["ListAllUITests"])

# For more information about all available options run
# fastlane action snapshot
