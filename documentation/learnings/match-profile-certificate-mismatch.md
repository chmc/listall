# Match Provisioning Profile / Certificate Mismatch

## Date: 2026-01-05

## Status: RESOLVED

## Problem
macOS build failed with error:
```
Provisioning profile "match Unknown io.github.chmc.ListAll macos" doesn't include signing certificate "Apple Distribution: Aleksi Sutela (M9BR5FY93A)"
```

## Root Cause
The macOS provisioning profile in the Match repo was created manually on Apple Developer Portal (not via Match). When a profile is created this way:

1. It gets associated with whichever certificate was selected at creation time
2. Match can't know which certificate was used
3. The profile name becomes "match Unknown..." instead of "match AppStore..."
4. When the certificate in Match repo doesn't match the one embedded in the profile, code signing fails

## Solution: Regenerate Profile via Match

The profile needs to be regenerated by Match so it:
1. Uses the correct certificate from the Match repo
2. Gets the proper "match AppStore" naming convention

### Run the refresh command locally:

```bash
# Set ASC credentials (get from 1Password or GitHub secrets)
export ASC_KEY_ID="your_key_id"
export ASC_ISSUER_ID="your_issuer_id"
export ASC_KEY_BASE64="$(cat /path/to/AuthKey.p8 | base64)"

# Run the refresh lane
bundle exec fastlane refresh_macos_profiles
```

This will:
1. Delete the old profile from Apple Developer Portal
2. Create a new profile linked to the certificate in Match repo
3. Update the Match repo with the new properly-named profile

### Alternative: Manual Fix via Apple Developer Portal

1. Go to [Apple Developer Portal - Profiles](https://developer.apple.com/account/resources/profiles/list)
2. Delete the macOS App Store profile for `io.github.chmc.ListAll`
3. Create new profile, selecting the correct "Apple Distribution" certificate
4. Download and encrypt with Match format
5. Add to Match repo in `profiles/appstore/AppStore_io.github.chmc.ListAll.provisionprofile`

## Prevention

Always use Match to create provisioning profiles instead of creating them manually:

```bash
# Create new profile via Match (not manually)
bundle exec fastlane match appstore --platform macos --app_identifier io.github.chmc.ListAll
```

This ensures the profile is:
- Created with the certificate Match manages
- Properly named ("match AppStore...")
- Encrypted and stored correctly in the Match repo

## Related Files
- `fastlane/Fastfile` - `refresh_macos_profiles` lane
- Match repo: `profiles/appstore/AppStore_io.github.chmc.ListAll.provisionprofile`
